# -*- coding: utf-8 -*-
"""
סקריפט לייבוא תלמידים מטבלה
"""

from services.database import YeshivaDatabase

# נתוני התלמידים מהטבלה
students_data = """
א'	אייזנטל	מנחם	335464368	08/08/2012	מרדכי שלמה	35756212	אסתר גיטל	35711431	02-5808927	0527618927	קעניג 14	ביתר עילית
א'	ארול	אהרון	335797494	25/02/2012	נחמן	16021719	צפורה	32870982	02-5328455	533155910	 שמואל הנביא 11	ירושלים
א'	בן משה	יוסף חיים	335875902	08/08/2012	דניאל אברהם	336375159	איריס	34247213	0583275584	0504175584	דניאל סירקיס 8/9	ירושלים
א'	ויט	שמעון שלום	336719604	08/08/2012	יחד יוסף	38277638	רונית	27208081	02-9993438	0583230252	עקביא בן מהללאל 4/3	בית שמש
א'	קאופמן	משה אליהו	 336723978	 04/02/2012	ירחמיאל יהודא	33288580	זיסל	33677238	02-5860557	0527680860	מינץ 21	ירושלים
א'	קיל	שמואל	336046156	08/08/2012	מאיר	36020857	רבקה	36110419	02-5725784	0527676523	כף החיים 22/1	ביתר עילית
א'	קיל	שמעון שלום	221257090	08/08/2012	מאיר	39695945	חנה ליבא	39760277	02-6419523	0527129944	הרב פרנק 13	ירושלים
א'	רייכר	אהרון	335128658	08/08/2012	יוסף	33893876	שרה	35699586	0722486000	0583210409	הרב נאה 10	ירושלים
א'	רקובר	אהרון זאב	335581922	02/04/2012	שמחה בונים חיים	39271408	חיה הינדא	301788535	04-6002433	527112068	לוחמי הגיטאות 7 	צפת
ב'	אשכנזי	נחמן	334634847	04/02/2011	יגאל	59831909	מיכל	28638377	02-5800376	0548425051	מוצפי 11	ביתר עילית
ב'	בן שם	מאיר דוד	219956158	08/11/2010	שמחה גד	24293003	שרה	29333846	02-5807035	052-7612305	כנסת יחזקאל 14	ביתר עילית
ב'	בסרמן	נחמן	219939626	13/12/2010	נתן	21575016	חיה	203208863	0527155603	0527155649	יונה 23	ירושלים
ב'	בר נתן	ישעיה	334106358	11/12/2009	עקיבא	28993871	הינדא	28645281	02-5806805	0527622489	דברי חיים 6/12	ביתר עילית
ב'	בריכטא	יצחק זאב	335175873	23/04/2011	צבי	300510781	חיה אסתר	39082955	02-5002987	0527129392	כף החיים 32	ביתר עילית
ב'	גרליץ	אלימלך	219184470	14/11/2011	אשר אליהו	28497782	לאה	27382829	0527655161	0527655126	 	אור הגנוז
ב'	ויליגר	שמעון	334752052	14/07/2010	מנדל מנחם שלום	 	ברכה	37667854	02-5003205	0527637150	אבן האזל 13	ירושלים
ב'	זונאבנד	צבי הערש	219946852	25/11/2010	שמעון שלום	40699019	שרה ריבה	39921721	02-5803276	0548447641	יסוד העבודה 9	ביתר עילית
ב'	יעקובביץ	דוד יהודה	219940657	10/12/2010	שמעון שלום	60867058	חיה מלכה	52719796	02-5022237	0527620040	מפעל הש"ס 22	ביתר עילית
ב'	כהן	ישראל	220412530	23/01/2011	אברהם	34215988	מיכל	37399623	0556784932	0534177215	 	אור הגנוז
ב'	מיליקובסקי	יר"י מאיר	335291217	01/06/2011	ברוך	21926266	פרידא	327729646	02-6529101	0527699109	הרב שך 31	ביתר עילית
ב'	ערליך	אברהם יצחק	341312197	22/07/2010	אפרים פישל	341312155	רחל אסתר	341312163	02-5096688	0583219492	אבן האזל 13/02	ירושלים
ב'	פרידמן	מנחם מנדל	219043833	23/11/2010	פנחס	60873700	ברכה	62879705	 	0548464551	קדושת לוי 46/22	ביתר עילית
ב'	קאופמן	פנחס אהרון	335057451	01/07/2011	יצחק	43559764	שרה פרידא	62849864	0527676481	0527676482	קדושת לוי 112	ביתר עילית
ב'	קלויזנר	ישראל יואל	200754612	13/02/2011	צבי הירש	21684394	חוה	200754612	0527687766	0527698082	מוצפי 13/11	ביתר עילית
ב'	רוזנטל	חיים נחום	334871316	07/08/2010	יעקב	300902087	גיטל בלומה	304759778	02-5003034	 	הרב מלובביץ 10/6	ביתר עילית
ב'	רוזנטל	שמעון	334696275	03/09/2010	משה	326850476	אלישבע	43544436	02-5804536	0527649764	החיד"א 29	ירושלים
ב'	רוט	אלימלך	219616935	17/02/2011	אביתר	28793727	אביגיל	27343904	02-6517260	0527671055	פנים מאירות 1	ירושלים
ב'	שושן 	חיים 	219110434	26/06/2010	מרדכי	23911084	זיוה	24593493	0527655199	0504102360	דון יוסף הנשיא 7	ירושלים
ג'	אברמוביץ	אליהו	218931434	13/09/2010	יהודה דוד	21992441	טובה	304940638	 	0523437165	דרכי איש 2/7	ביתר עילית
ג'	בן שם	מאיר דוד	334104544	28/11/2009	יצחק	34672543	חנה	32541179	0527694023	0527107554	דרכי איש 8	ביתר עילית
ג'	גולד	נחמן	334602323	18/02/2010	לוי יצחק	301787776	אדל	200520583	02-5322322	0548459888	אלגזי 26/4	ירושלים
ג'	כהן	נתן	218280659	07/05/2009	נחמן	303182513	מרים	300247483	0527676652	0527676653	מבוא בשמת 1	ירושלים
ג'	לבינסון	מאיר	218999035	24/02/2010	יהונתן	17875212	עטרה	32393624	0527619017	0527682327	פחד יצחק 37	ביתר עילית
ג'	מיליקובסקי	פנחס מנחם	335000436	07/07/2010	שמעון שלום	39987979	תמר 	60172871	02-5805629	0527171032	דרכי איש 6	ביתר עילית
ג'	פרידמן	משה	335350385	03/01/2011	יחזקאל צבי	22967789	בינה	24167868	03-5742292	0533157422	דמשק אליעזר 39	בני ברק
ג'	קאופמן	בנימין שרגא	218984433	21/01/2010	יצחק	43559764	שרה פרידא	62849864	0527676481	0527676482	קדושת לוי 112	ביתר עילית
ג'	רוזן	חיים	343103322	18/11/2009	אליעזר	28647790	ברוריה	33407222	02-5807889	0533162889	אש קודש 9/3	ביתר עילית
ג'	רוט	שמעון	219288099	13/09/2010	אהרן	300352044	שולמית	314156050	0548491641	0548491642	לוחמי הגטאות 47/11	צפת
ג'	שטרן	נחמן	219187705	16/04/2010	יהודה	201075595	אודל	304894801	02-6642929	0527659148	סלנט 12	ירושלים
"""

def parse_students_table(table_text):
    """פירוק טבלת התלמידים לרשימה של דיקשנריז"""
    lines = [line.strip() for line in table_text.strip().split('\n') if line.strip()]
    students = []

    for line in lines:
        fields = line.split('\t')
        if len(fields) != 13:
            print(f"שגיאה: שורה עם {len(fields)} שדות במקום 13: {line[:50]}")
            continue

        student = {
            'current_grade': fields[0].strip(),
            'last_name': fields[1].strip(),
            'first_name': fields[2].strip(),
            'id_number': fields[3].strip(),
            'birth_date_hebrew': fields[4].strip(),
            'father_name': fields[5].strip(),
            'father_id_number': fields[6].strip(),
            'mother_name': fields[7].strip(),
            'mother_id_number': fields[8].strip(),
            'home_phone': fields[9].strip(),
            'father_phone': fields[10].strip(),  # פלאפון
            'mother_phone': '',
            'address': fields[11].strip(),
            'city': fields[12].strip(),
            'entry_date_hebrew': '',
            'status': 'פעיל',
            'framework_type': 'רגיל',
            'notes': ''
        }
        students.append(student)

    return students

def main():
    print("[*] מתחיל תהליך ייבוא תלמידים...")

    db = YeshivaDatabase()

    # 1. מחיקת כל התלמידים הקיימים
    print("[*] מוחק את כל התלמידים הקיימים...")
    db.delete_all_students()
    print("[V] כל התלמידים הישנים נמחקו")

    # 2. פירוק הטבלה
    print("\n[*] מפרק את טבלת התלמידים...")
    students = parse_students_table(students_data)
    print(f"[V] נמצאו {len(students)} תלמידים")

    # הצגת דוגמה
    if students:
        print("\n[*] דוגמה לתלמיד ראשון:")
        first = students[0]
        print(f"  שיעור: {first['current_grade']}")
        print(f"  שם משפחה: {first['last_name']}")
        print(f"  שם פרטי: {first['first_name']}")
        print(f"  ת.ז.: {first['id_number']}")
        print(f"  תאריך לידה: {first['birth_date_hebrew']}")
        print(f"  שם האב: {first['father_name']}")
        print(f"  ת.ז. אב: {first['father_id_number']}")
        print(f"  שם האם: {first['mother_name']}")
        print(f"  ת.ז. אם: {first['mother_id_number']}")
        print(f"  טלפון בית: {first['home_phone']}")
        print(f"  פלאפון: {first['father_phone']}")
        print(f"  כתובת: {first['address']}")
        print(f"  עיר: {first['city']}")

    # 3. הוספת התלמידים
    print(f"\n[+] מוסיף {len(students)} תלמידים...")
    added_count = 0
    for i, student in enumerate(students, 1):
        try:
            db.add_student(student)
            added_count += 1
            print(f"  [V] {i}/{len(students)}: {student['first_name']} {student['last_name']} (כיתה {student['current_grade']})")
        except Exception as e:
            print(f"  [X] שגיאה בהוספת {student['first_name']} {student['last_name']}: {e}")

    print(f"\n[!] סיימנו! נוספו {added_count} תלמידים בהצלחה!")
    print(f"\n[*] סיכום:")
    grade_a = sum(1 for s in students if s['current_grade'] == 'א\'')
    grade_b = sum(1 for s in students if s['current_grade'] == 'ב\'')
    grade_c = sum(1 for s in students if s['current_grade'] == 'ג\'')
    print(f"  - כיתה א': {grade_a} תלמידים")
    print(f"  - כיתה ב': {grade_b} תלמידים")
    print(f"  - כיתה ג': {grade_c} תלמידים")

if __name__ == '__main__':
    main()
